{"version":3,"sources":["../../providers/redis_provider.ts"],"sourcesContent":["/*\n * @adonisjs/redis\n *\n * (c) AdonisJS\n *\n * For the full copyright and license information, please view the LICENSE\n * file that was distributed with this source code.\n */\n\nimport type { ApplicationService } from '@adonisjs/core/types'\nimport type { RedisService } from '../src/types.js'\n\ndeclare module '@adonisjs/core/types' {\n  export interface ContainerBindings {\n    redis: RedisService\n  }\n}\n\n/**\n * Registering the Redis manager as a singleton to the container\n * and defining REPL bindings\n */\nexport default class RedisProvider {\n  constructor(protected app: ApplicationService) {}\n\n  /**\n   * Define repl bindings\n   */\n  protected async defineReplBindings() {\n    if (this.app.getEnvironment() !== 'repl') {\n      return\n    }\n\n    const { defineReplBindings } = await import('../src/repl_bindings.js')\n    defineReplBindings(this.app, await this.app.container.make('repl'))\n  }\n\n  /**\n   * Register the Redis manager as a singleton with the\n   * container\n   */\n  register() {\n    this.app.container.singleton('redis', async () => {\n      const { default: RedisManager } = await import('../src/redis_manager.js')\n\n      const config = this.app.config.get<any>('redis', {})\n      const logger = await this.app.container.make('logger')\n      return new RedisManager(config, logger)\n    })\n  }\n\n  /**\n   * Defining repl bindings on boot\n   */\n  async boot() {\n    await this.defineReplBindings()\n  }\n\n  /**\n   * Gracefully shutdown connections when app goes down\n   */\n  async shutdown() {\n    const redis = await this.app.container.make('redis')\n    await redis.quitAll()\n  }\n}\n"],"mappings":";;;AAsBA,IAAqB,gBAArB,MAAmC;AAAA,EACjC,YAAsB,KAAyB;AAAzB;AAAA,EAA0B;AAAA;AAAA;AAAA;AAAA,EAKhD,MAAgB,qBAAqB;AACnC,QAAI,KAAK,IAAI,eAAe,MAAM,QAAQ;AACxC;AAAA,IACF;AAEA,UAAM,EAAE,mBAAmB,IAAI,MAAM,OAAO,8BAAyB;AACrE,uBAAmB,KAAK,KAAK,MAAM,KAAK,IAAI,UAAU,KAAK,MAAM,CAAC;AAAA,EACpE;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,WAAW;AACT,SAAK,IAAI,UAAU,UAAU,SAAS,YAAY;AAChD,YAAM,EAAE,SAAS,aAAa,IAAI,MAAM,OAAO,8BAAyB;AAExE,YAAM,SAAS,KAAK,IAAI,OAAO,IAAS,SAAS,CAAC,CAAC;AACnD,YAAM,SAAS,MAAM,KAAK,IAAI,UAAU,KAAK,QAAQ;AACrD,aAAO,IAAI,aAAa,QAAQ,MAAM;AAAA,IACxC,CAAC;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,OAAO;AACX,UAAM,KAAK,mBAAmB;AAAA,EAChC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,WAAW;AACf,UAAM,QAAQ,MAAM,KAAK,IAAI,UAAU,KAAK,OAAO;AACnD,UAAM,MAAM,QAAQ;AAAA,EACtB;AACF;","names":[]}